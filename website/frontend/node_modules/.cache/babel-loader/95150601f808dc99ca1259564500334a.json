{"ast":null,"code":"var _jsxFileName = \"/home/yi/Desktop/rengorum/frontend/src/components/newpost/index.js\";\nimport React, { Component } from 'react';\nimport { getSelectedBlock } from 'draftjs-utils';\nimport htmlToDraft from 'html-to-draftjs';\nimport { List } from 'immutable';\nimport { EditorState, convertToRaw, Modifier } from 'draft-js';\nimport { Form, Icon, Button } from 'semantic-ui-react';\nimport './styles.css';\nimport RichEditor from '../richeditor';\nimport StatusMessage from '../statusmessage';\nexport default class NewPost extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onEditorStateChange = editorState => {\n      this.setState({\n        editorState\n      });\n    };\n\n    this.onSubmit = () => {\n      const editorState = this.state.editorState;\n      const _this$props = this.props,\n            threadID = _this$props.threadID,\n            createPost = _this$props.createPost;\n      const content = JSON.stringify(convertToRaw(editorState.getCurrentContent()));\n      let newPost = {\n        thread_id: threadID,\n        content: content\n      };\n      createPost(newPost);\n    };\n\n    this.isValidLength = contentState => {\n      const maxLength = this.props.maxLength || 1000;\n      return contentState.getPlainText('').length <= maxLength;\n    };\n\n    this.handleBeforeInput = input => {\n      const editorState = this.state.editorState;\n\n      if (!this.isValidLength(editorState.getCurrentContent())) {\n        return 'handled';\n      }\n    };\n\n    this.handlePastedText = (text, html, editorState, onChange) => {\n      if (html) {\n        const contentBlock = htmlToDraft(html);\n        let contentState = editorState.getCurrentContent();\n        contentBlock.entityMap.forEach((value, key) => {\n          contentState = contentState.mergeEntityData(key, value);\n        });\n        contentState = Modifier.replaceWithFragment(contentState, editorState.getSelection(), new List(contentBlock.contentBlocks));\n\n        if (!this.isValidLength(contentState)) {\n          return 'handled';\n        }\n\n        onChange(EditorState.push(editorState, contentState, 'insert-characters'));\n        return true;\n      }\n\n      const selectedBlock = getSelectedBlock(editorState);\n      const newState = Modifier.replaceText(editorState.getCurrentContent(), editorState.getSelection(), text, editorState.getCurrentInlineStyle());\n\n      if (!this.isValidLength(newState)) {\n        return 'handled';\n      }\n\n      onChange(EditorState.push(editorState, newState, 'insert-characters'));\n\n      if (selectedBlock && selectedBlock.type === 'code') {\n        return true;\n      }\n\n      return false;\n    };\n\n    this.state = {\n      editorState: EditorState.createEmpty()\n    };\n  }\n\n  componentWillReceiveProps(newProps) {\n    const success = newProps.success;\n\n    if (success) {\n      this.setState({\n        editorState: EditorState.createEmpty()\n      });\n    }\n  }\n\n  render() {\n    const _this$props2 = this.props,\n          isAuthenticated = _this$props2.isAuthenticated,\n          isLoading = _this$props2.isLoading,\n          error = _this$props2.error;\n\n    if (!isAuthenticated) {\n      return React.createElement(\"div\", {\n        className: \"newPost-none\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100\n        },\n        __self: this\n      }, 'Please sign in to post a reply');\n    }\n\n    const editorState = this.state.editorState;\n    const statusMessage = React.createElement(StatusMessage, {\n      error: error,\n      errorClassName: \"newPost-message\",\n      errorMessage: error || 'Oops! Something went wrong.',\n      type: \"modal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    });\n    return React.createElement(\"div\", {\n      className: \"newPost-show\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, statusMessage, React.createElement(Form, {\n      loading: isLoading,\n      className: \"attached fluid segment\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116\n      },\n      __self: this\n    }, React.createElement(RichEditor, {\n      placeholder: \"Start typing your post content here...\",\n      editorState: editorState,\n      wrapperClassName: \"newPost-wrapper\",\n      toolbarClassName: \"newPost-toolbar\",\n      editorClassName: \"newPost-editor\",\n      onEditorStateChange: this.onEditorStateChange,\n      handleBeforeInput: this.handleBeforeInput,\n      handlePastedText: this.handlePastedText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }), React.createElement(Button, {\n      color: \"blue\",\n      size: \"small\",\n      loading: isLoading,\n      disabled: isLoading,\n      onClick: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }, React.createElement(Icon, {\n      name: \"write\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }), \"Post\")));\n  }\n\n}","map":{"version":3,"sources":["/home/yi/Desktop/rengorum/frontend/src/components/newpost/index.js"],"names":["React","Component","getSelectedBlock","htmlToDraft","List","EditorState","convertToRaw","Modifier","Form","Icon","Button","RichEditor","StatusMessage","NewPost","constructor","props","onEditorStateChange","editorState","setState","onSubmit","state","threadID","createPost","content","JSON","stringify","getCurrentContent","newPost","thread_id","isValidLength","contentState","maxLength","getPlainText","length","handleBeforeInput","input","handlePastedText","text","html","onChange","contentBlock","entityMap","forEach","value","key","mergeEntityData","replaceWithFragment","getSelection","contentBlocks","push","selectedBlock","newState","replaceText","getCurrentInlineStyle","type","createEmpty","componentWillReceiveProps","newProps","success","render","isAuthenticated","isLoading","error","statusMessage"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\r\nimport {getSelectedBlock} from 'draftjs-utils';\r\nimport htmlToDraft from 'html-to-draftjs';\r\nimport {List} from 'immutable';\r\nimport {EditorState, convertToRaw, Modifier} from 'draft-js';\r\nimport {Form, Icon, Button} from 'semantic-ui-react';\r\nimport './styles.css';\r\nimport RichEditor from '../richeditor';\r\nimport StatusMessage from '../statusmessage';\r\n\r\nexport default class NewPost extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      editorState: EditorState.createEmpty(),\r\n    };\r\n  }\r\n\r\n  componentWillReceiveProps(newProps) {\r\n    const {success} = newProps;\r\n    if (success) {\r\n      this.setState({\r\n        editorState: EditorState.createEmpty(),\r\n      });\r\n    }\r\n  }\r\n\r\n  onEditorStateChange = editorState => {\r\n    this.setState({\r\n      editorState,\r\n    });\r\n  };\r\n\r\n  onSubmit = () => {\r\n    const {editorState} = this.state;\r\n    const {threadID, createPost} = this.props;\r\n    const content = JSON.stringify(\r\n      convertToRaw(editorState.getCurrentContent()),\r\n    );\r\n    let newPost = {\r\n      thread_id: threadID,\r\n      content: content,\r\n    };\r\n    createPost(newPost);\r\n  };\r\n\r\n  isValidLength = contentState => {\r\n    const maxLength = this.props.maxLength || 1000;\r\n    return contentState.getPlainText('').length <= maxLength;\r\n  };\r\n\r\n  handleBeforeInput = input => {\r\n    const {editorState} = this.state;\r\n    if (!this.isValidLength(editorState.getCurrentContent())) {\r\n      return 'handled';\r\n    }\r\n  };\r\n\r\n  handlePastedText = (text, html, editorState, onChange) => {\r\n    if (html) {\r\n      const contentBlock = htmlToDraft(html);\r\n      let contentState = editorState.getCurrentContent();\r\n      contentBlock.entityMap.forEach((value, key) => {\r\n        contentState = contentState.mergeEntityData(key, value);\r\n      });\r\n      contentState = Modifier.replaceWithFragment(\r\n        contentState,\r\n        editorState.getSelection(),\r\n        new List(contentBlock.contentBlocks),\r\n      );\r\n      if (!this.isValidLength(contentState)) {\r\n        return 'handled';\r\n      }\r\n      onChange(\r\n        EditorState.push(editorState, contentState, 'insert-characters'),\r\n      );\r\n      return true;\r\n    }\r\n    const selectedBlock = getSelectedBlock(editorState);\r\n    const newState = Modifier.replaceText(\r\n      editorState.getCurrentContent(),\r\n      editorState.getSelection(),\r\n      text,\r\n      editorState.getCurrentInlineStyle(),\r\n    );\r\n    if (!this.isValidLength(newState)) {\r\n      return 'handled';\r\n    }\r\n    onChange(EditorState.push(editorState, newState, 'insert-characters'));\r\n    if (selectedBlock && selectedBlock.type === 'code') {\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  render() {\r\n    const {isAuthenticated, isLoading, error} = this.props;\r\n    if (!isAuthenticated) {\r\n      return (\r\n        <div className=\"newPost-none\">{'Please sign in to post a reply'}</div>\r\n      );\r\n    }\r\n    const {editorState} = this.state;\r\n    const statusMessage = (\r\n      <StatusMessage\r\n        error={error}\r\n        errorClassName=\"newPost-message\"\r\n        errorMessage={error || 'Oops! Something went wrong.'}\r\n        type=\"modal\"\r\n      />\r\n    );\r\n\r\n    return (\r\n      <div className=\"newPost-show\">\r\n        {statusMessage}\r\n        <Form loading={isLoading} className=\"attached fluid segment\">\r\n          <RichEditor\r\n            placeholder=\"Start typing your post content here...\"\r\n            editorState={editorState}\r\n            wrapperClassName=\"newPost-wrapper\"\r\n            toolbarClassName=\"newPost-toolbar\"\r\n            editorClassName=\"newPost-editor\"\r\n            onEditorStateChange={this.onEditorStateChange}\r\n            handleBeforeInput={this.handleBeforeInput}\r\n            handlePastedText={this.handlePastedText}\r\n          />\r\n          <Button\r\n            color=\"blue\"\r\n            size=\"small\"\r\n            loading={isLoading}\r\n            disabled={isLoading}\r\n            onClick={this.onSubmit}>\r\n            <Icon name=\"write\" />\r\n            Post\r\n          </Button>\r\n        </Form>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}
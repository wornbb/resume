{"ast":null,"code":"var _jsxFileName = \"/home/yi/Desktop/rengorum/frontend/src/components/newthread/index.js\";\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport { getSelectedBlock } from 'draftjs-utils';\nimport htmlToDraft from 'html-to-draftjs';\nimport { List } from 'immutable';\nimport { EditorState, ContentState, convertFromRaw, convertToRaw, Modifier } from 'draft-js';\nimport { Form, Icon, Divider, Button } from 'semantic-ui-react';\nimport './styles.css';\nimport RichEditor from '../richeditor';\nimport StatusMessage from '../statusmessage';\nexport default class NewThread extends Component {\n  constructor(props) {\n    super(props);\n\n    this.convertToEditorState = content => {\n      let editorState = EditorState.createEmpty();\n\n      if (content) {\n        try {\n          const contentState = convertFromRaw(JSON.parse(content));\n          editorState = EditorState.createWithContent(contentState);\n        } catch (error) {\n          const contentState = ContentState.createFromText(content);\n          editorState = EditorState.createWithContent(contentState);\n        }\n      }\n\n      return editorState;\n    };\n\n    this.toggleShowEditor = () => {\n      this.props.toggleShowEditor();\n    };\n\n    this.onSave = () => {\n      // save to redux store (uncontrolled input way)\n      const _this$state = this.state,\n            name = _this$state.name,\n            editorState = _this$state.editorState;\n      const content = JSON.stringify(convertToRaw(editorState.getCurrentContent()));\n      this.props.updateNewThread({\n        name: name,\n        content: content\n      });\n      this.toggleShowEditor();\n    };\n\n    this.onCancel = () => {\n      // reset & clear everything\n      const editorState = EditorState.createEmpty();\n      this.setState({\n        name: '',\n        editorState\n      });\n      const content = JSON.stringify(convertToRaw(editorState.getCurrentContent()));\n      this.props.updateNewThread({\n        name: '',\n        content: content\n      });\n      this.toggleShowEditor();\n    };\n\n    this.onNameChange = (e, {\n      value\n    }) => {\n      this.setState({\n        name: value\n      });\n    };\n\n    this.onEditorStateChange = editorState => {\n      this.setState({\n        editorState\n      });\n    };\n\n    this.isFormValid = () => {\n      const name = this.state.name;\n      return name;\n    };\n\n    this.onSubmit = () => {\n      if (this.isFormValid()) {\n        const _this$state2 = this.state,\n              name = _this$state2.name,\n              editorState = _this$state2.editorState;\n        const _this$props = this.props,\n              forum = _this$props.forum,\n              createThread = _this$props.createThread;\n        const content = JSON.stringify(convertToRaw(editorState.getCurrentContent()));\n        let newThread = {\n          name: name,\n          forum: forum,\n          content: content\n        };\n        createThread(newThread);\n      }\n    };\n\n    this.isValidLength = contentState => {\n      const maxLength = this.props.maxLength || 100;\n      return contentState.getPlainText('').length <= maxLength;\n    };\n\n    this.handleBeforeInput = input => {\n      const editorState = this.state.editorState;\n\n      if (!this.isValidLength(editorState.getCurrentContent())) {\n        return 'handled';\n      }\n    };\n\n    this.handlePastedText = (text, html, editorState, onChange) => {\n      if (html) {\n        const contentBlock = htmlToDraft(html);\n        let contentState = editorState.getCurrentContent();\n        contentBlock.entityMap.forEach((value, key) => {\n          contentState = contentState.mergeEntityData(key, value);\n        });\n        contentState = Modifier.replaceWithFragment(contentState, editorState.getSelection(), new List(contentBlock.contentBlocks));\n\n        if (!this.isValidLength(contentState)) {\n          return 'handled';\n        }\n\n        onChange(EditorState.push(editorState, contentState, 'insert-characters'));\n        return true;\n      }\n\n      const selectedBlock = getSelectedBlock(editorState);\n      const newState = Modifier.replaceText(editorState.getCurrentContent(), editorState.getSelection(), text, editorState.getCurrentInlineStyle());\n\n      if (!this.isValidLength(newState)) {\n        return 'handled';\n      }\n\n      onChange(EditorState.push(editorState, newState, 'insert-characters'));\n\n      if (selectedBlock && selectedBlock.type === 'code') {\n        return true;\n      }\n\n      return false;\n    };\n\n    const _this$props2 = this.props,\n          _name = _this$props2.name,\n          _content = _this$props2.content;\n\n    let _editorState = this.convertToEditorState(_content);\n\n    this.state = {\n      name: _name,\n      editorState: _editorState\n    };\n  }\n\n  componentWillReceiveProps(newProps) {\n    const newName = newProps.name,\n          newContent = newProps.content;\n    const editorState = this.convertToEditorState(newContent);\n    this.setState({\n      name: newName,\n      editorState\n    });\n  }\n\n  render() {\n    const _this$props3 = this.props,\n          isAuthenticated = _this$props3.isAuthenticated,\n          isLoading = _this$props3.isLoading,\n          success = _this$props3.success,\n          id = _this$props3.id,\n          error = _this$props3.error,\n          showEditor = _this$props3.showEditor;\n    const _this$state3 = this.state,\n          name = _this$state3.name,\n          editorState = _this$state3.editorState;\n\n    if (!isAuthenticated) {\n      return React.createElement(\"div\", {\n        className: \"newThread-none\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179\n        },\n        __self: this\n      });\n    }\n\n    const statusMessage = React.createElement(StatusMessage, {\n      error: error,\n      errorClassName: \"newThread-message\",\n      errorMessage: error || 'Oops! Something went wrong.',\n      success: success,\n      successClassName: \"newThread-message\",\n      successMessage: React.createElement(Link, {\n        to: \"/thread/\".concat(id),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, 'Successful on creating thread'),\n      type: \"modal\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    });\n\n    if (!showEditor) {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, statusMessage, \" \", React.createElement(\"div\", {\n        className: \"newThread-hidden\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, React.createElement(Button, {\n        size: \"small\",\n        color: \"blue\",\n        floated: \"left\",\n        onClick: this.toggleShowEditor,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }, React.createElement(Icon, {\n        name: \"edit\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 206\n        },\n        __self: this\n      }), \"New Thread\")));\n    }\n\n    return React.createElement(\"div\", {\n      className: \"newThread-show\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, statusMessage, React.createElement(Form, {\n      loading: isLoading,\n      className: \"attached fluid segment\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }, React.createElement(Form.Input, {\n      required: true,\n      fluid: true,\n      transparent: true,\n      icon: \"edit\",\n      iconPosition: \"left\",\n      size: \"big\",\n      placeholder: \"Name\",\n      type: \"text\",\n      name: \"name\",\n      value: name,\n      onChange: this.onNameChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }), React.createElement(Divider, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }), React.createElement(RichEditor, {\n      placeholder: \"Start typing your thread content here...\",\n      editorState: editorState,\n      wrapperClassName: \"newThread-wrapper\",\n      toolbarClassName: \"newThread-toolbar\",\n      editorClassName: \"newThread-editor\",\n      onEditorStateChange: this.onEditorStateChange,\n      handleBeforeInput: this.handleBeforeInput,\n      handlePastedText: this.handlePastedText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    }), React.createElement(Button, {\n      color: \"blue\",\n      size: \"small\",\n      loading: isLoading,\n      disabled: isLoading,\n      onClick: this.onSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, React.createElement(Icon, {\n      name: \"edit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }), \"Post thread\"), React.createElement(Button, {\n      color: \"red\",\n      role: \"none\",\n      size: \"small\",\n      disabled: isLoading,\n      onClick: this.onSave,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251\n      },\n      __self: this\n    }, React.createElement(Icon, {\n      name: \"save\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257\n      },\n      __self: this\n    }), \"Save Draft\"), React.createElement(Button, {\n      role: \"none\",\n      size: \"small\",\n      disabled: isLoading,\n      onClick: this.onCancel,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260\n      },\n      __self: this\n    }, React.createElement(Icon, {\n      name: \"cancel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }), \"Clear\")));\n  }\n\n}","map":{"version":3,"sources":["/home/yi/Desktop/rengorum/frontend/src/components/newthread/index.js"],"names":["React","Component","Link","getSelectedBlock","htmlToDraft","List","EditorState","ContentState","convertFromRaw","convertToRaw","Modifier","Form","Icon","Divider","Button","RichEditor","StatusMessage","NewThread","constructor","props","convertToEditorState","content","editorState","createEmpty","contentState","JSON","parse","createWithContent","error","createFromText","toggleShowEditor","onSave","state","name","stringify","getCurrentContent","updateNewThread","onCancel","setState","onNameChange","e","value","onEditorStateChange","isFormValid","onSubmit","forum","createThread","newThread","isValidLength","maxLength","getPlainText","length","handleBeforeInput","input","handlePastedText","text","html","onChange","contentBlock","entityMap","forEach","key","mergeEntityData","replaceWithFragment","getSelection","contentBlocks","push","selectedBlock","newState","replaceText","getCurrentInlineStyle","type","componentWillReceiveProps","newProps","newName","newContent","render","isAuthenticated","isLoading","success","id","showEditor","statusMessage"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport {getSelectedBlock} from 'draftjs-utils';\r\nimport htmlToDraft from 'html-to-draftjs';\r\nimport {List} from 'immutable';\r\nimport {\r\n  EditorState,\r\n  ContentState,\r\n  convertFromRaw,\r\n  convertToRaw,\r\n  Modifier,\r\n} from 'draft-js';\r\nimport {Form, Icon, Divider, Button} from 'semantic-ui-react';\r\nimport './styles.css';\r\nimport RichEditor from '../richeditor';\r\nimport StatusMessage from '../statusmessage';\r\n\r\nexport default class NewThread extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const {name, content} = this.props;\r\n    let editorState = this.convertToEditorState(content);\r\n    this.state = {\r\n      name,\r\n      editorState,\r\n    };\r\n  }\r\n\r\n  componentWillReceiveProps(newProps) {\r\n    const {name: newName, content: newContent} = newProps;\r\n    const editorState = this.convertToEditorState(newContent);\r\n    this.setState({\r\n      name: newName,\r\n      editorState,\r\n    });\r\n  }\r\n\r\n  convertToEditorState = content => {\r\n    let editorState = EditorState.createEmpty();\r\n    if (content) {\r\n      try {\r\n        const contentState = convertFromRaw(JSON.parse(content));\r\n        editorState = EditorState.createWithContent(contentState);\r\n      } catch (error) {\r\n        const contentState = ContentState.createFromText(content);\r\n        editorState = EditorState.createWithContent(contentState);\r\n      }\r\n    }\r\n    return editorState;\r\n  };\r\n\r\n  toggleShowEditor = () => {\r\n    this.props.toggleShowEditor();\r\n  };\r\n\r\n  onSave = () => {\r\n    // save to redux store (uncontrolled input way)\r\n    const {name, editorState} = this.state;\r\n    const content = JSON.stringify(\r\n      convertToRaw(editorState.getCurrentContent()),\r\n    );\r\n    this.props.updateNewThread({\r\n      name: name,\r\n      content: content,\r\n    });\r\n    this.toggleShowEditor();\r\n  };\r\n\r\n  onCancel = () => {\r\n    // reset & clear everything\r\n    const editorState = EditorState.createEmpty();\r\n    this.setState({\r\n      name: '',\r\n      editorState,\r\n    });\r\n    const content = JSON.stringify(\r\n      convertToRaw(editorState.getCurrentContent()),\r\n    );\r\n    this.props.updateNewThread({\r\n      name: '',\r\n      content: content,\r\n    });\r\n    this.toggleShowEditor();\r\n  };\r\n\r\n  onNameChange = (e, {value}) => {\r\n    this.setState({\r\n      name: value,\r\n    });\r\n  };\r\n\r\n  onEditorStateChange = editorState => {\r\n    this.setState({\r\n      editorState,\r\n    });\r\n  };\r\n\r\n  isFormValid = () => {\r\n    const {name} = this.state;\r\n    return name;\r\n  };\r\n\r\n  onSubmit = () => {\r\n    if (this.isFormValid()) {\r\n      const {name, editorState} = this.state;\r\n      const {forum, createThread} = this.props;\r\n      const content = JSON.stringify(\r\n        convertToRaw(editorState.getCurrentContent()),\r\n      );\r\n      let newThread = {\r\n        name: name,\r\n        forum: forum,\r\n        content: content,\r\n      };\r\n      createThread(newThread);\r\n    }\r\n  };\r\n\r\n  isValidLength = contentState => {\r\n    const maxLength = this.props.maxLength || 100;\r\n    return contentState.getPlainText('').length <= maxLength;\r\n  };\r\n\r\n  handleBeforeInput = input => {\r\n    const {editorState} = this.state;\r\n    if (!this.isValidLength(editorState.getCurrentContent())) {\r\n      return 'handled';\r\n    }\r\n  };\r\n\r\n  handlePastedText = (text, html, editorState, onChange) => {\r\n    if (html) {\r\n      const contentBlock = htmlToDraft(html);\r\n      let contentState = editorState.getCurrentContent();\r\n      contentBlock.entityMap.forEach((value, key) => {\r\n        contentState = contentState.mergeEntityData(key, value);\r\n      });\r\n      contentState = Modifier.replaceWithFragment(\r\n        contentState,\r\n        editorState.getSelection(),\r\n        new List(contentBlock.contentBlocks),\r\n      );\r\n      if (!this.isValidLength(contentState)) {\r\n        return 'handled';\r\n      }\r\n      onChange(\r\n        EditorState.push(editorState, contentState, 'insert-characters'),\r\n      );\r\n      return true;\r\n    }\r\n    const selectedBlock = getSelectedBlock(editorState);\r\n    const newState = Modifier.replaceText(\r\n      editorState.getCurrentContent(),\r\n      editorState.getSelection(),\r\n      text,\r\n      editorState.getCurrentInlineStyle(),\r\n    );\r\n    if (!this.isValidLength(newState)) {\r\n      return 'handled';\r\n    }\r\n    onChange(EditorState.push(editorState, newState, 'insert-characters'));\r\n    if (selectedBlock && selectedBlock.type === 'code') {\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      isAuthenticated,\r\n      isLoading,\r\n      success,\r\n      id,\r\n      error,\r\n      showEditor,\r\n    } = this.props;\r\n    const {name, editorState} = this.state;\r\n    if (!isAuthenticated) {\r\n      return <div className=\"newThread-none\" />;\r\n    }\r\n\r\n    const statusMessage = (\r\n      <StatusMessage\r\n        error={error}\r\n        errorClassName=\"newThread-message\"\r\n        errorMessage={error || 'Oops! Something went wrong.'}\r\n        success={success}\r\n        successClassName=\"newThread-message\"\r\n        successMessage={\r\n          <Link to={`/thread/${id}`}>{'Successful on creating thread'}</Link>\r\n        }\r\n        type=\"modal\"\r\n      />\r\n    );\r\n\r\n    if (!showEditor) {\r\n      return (\r\n        <div>\r\n          {statusMessage} {/*this will only show the success message*/}\r\n          <div className=\"newThread-hidden\">\r\n            <Button\r\n              size=\"small\"\r\n              color=\"blue\"\r\n              floated=\"left\"\r\n              onClick={this.toggleShowEditor}>\r\n              <Icon name=\"edit\" />\r\n              New Thread\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className=\"newThread-show\">\r\n        {statusMessage}\r\n        <Form loading={isLoading} className=\"attached fluid segment\">\r\n          <Form.Input\r\n            required\r\n            fluid\r\n            transparent\r\n            icon=\"edit\"\r\n            iconPosition=\"left\"\r\n            size=\"big\"\r\n            placeholder=\"Name\"\r\n            type=\"text\"\r\n            name=\"name\"\r\n            value={name}\r\n            onChange={this.onNameChange}\r\n          />\r\n          <Divider />\r\n          <RichEditor\r\n            placeholder=\"Start typing your thread content here...\"\r\n            editorState={editorState}\r\n            wrapperClassName=\"newThread-wrapper\"\r\n            toolbarClassName=\"newThread-toolbar\"\r\n            editorClassName=\"newThread-editor\"\r\n            onEditorStateChange={this.onEditorStateChange}\r\n            handleBeforeInput={this.handleBeforeInput}\r\n            handlePastedText={this.handlePastedText}\r\n          />\r\n          <Button\r\n            color=\"blue\"\r\n            size=\"small\"\r\n            loading={isLoading}\r\n            disabled={isLoading}\r\n            onClick={this.onSubmit}>\r\n            <Icon name=\"edit\" />\r\n            Post thread\r\n          </Button>\r\n          <Button\r\n            color=\"red\"\r\n            role=\"none\"\r\n            size=\"small\"\r\n            disabled={isLoading}\r\n            onClick={this.onSave}>\r\n            <Icon name=\"save\" />\r\n            Save Draft\r\n          </Button>\r\n          <Button\r\n            role=\"none\"\r\n            size=\"small\"\r\n            disabled={isLoading}\r\n            onClick={this.onCancel}>\r\n            <Icon name=\"cancel\" />\r\n            Clear\r\n          </Button>\r\n        </Form>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}
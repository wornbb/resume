{"ast":null,"code":"import React,{Component}from'react';import{getSelectedBlock}from'draftjs-utils';import htmlToDraft from'html-to-draftjs';import{List}from'immutable';import{EditorState,convertToRaw,Modifier}from'draft-js';import{Form,Icon,Button}from'semantic-ui-react';import'./styles.css';import RichEditor from'../richeditor';import StatusMessage from'../statusmessage';export default class NewPost extends Component{constructor(props){super(props);this.onEditorStateChange=editorState=>{this.setState({editorState});};this.onSubmit=()=>{const editorState=this.state.editorState;const _this$props=this.props,threadID=_this$props.threadID,createPost=_this$props.createPost;const content=JSON.stringify(convertToRaw(editorState.getCurrentContent()));let newPost={thread_id:threadID,content:content};createPost(newPost);};this.isValidLength=contentState=>{const maxLength=this.props.maxLength||1000;return contentState.getPlainText('').length<=maxLength;};this.handleBeforeInput=input=>{const editorState=this.state.editorState;if(!this.isValidLength(editorState.getCurrentContent())){return'handled';}};this.handlePastedText=(text,html,editorState,onChange)=>{if(html){const contentBlock=htmlToDraft(html);let contentState=editorState.getCurrentContent();contentBlock.entityMap.forEach((value,key)=>{contentState=contentState.mergeEntityData(key,value);});contentState=Modifier.replaceWithFragment(contentState,editorState.getSelection(),new List(contentBlock.contentBlocks));if(!this.isValidLength(contentState)){return'handled';}onChange(EditorState.push(editorState,contentState,'insert-characters'));return true;}const selectedBlock=getSelectedBlock(editorState);const newState=Modifier.replaceText(editorState.getCurrentContent(),editorState.getSelection(),text,editorState.getCurrentInlineStyle());if(!this.isValidLength(newState)){return'handled';}onChange(EditorState.push(editorState,newState,'insert-characters'));if(selectedBlock&&selectedBlock.type==='code'){return true;}return false;};this.state={editorState:EditorState.createEmpty()};}componentWillReceiveProps(newProps){const success=newProps.success;if(success){this.setState({editorState:EditorState.createEmpty()});}}render(){const _this$props2=this.props,isAuthenticated=_this$props2.isAuthenticated,isLoading=_this$props2.isLoading,error=_this$props2.error;if(!isAuthenticated){return React.createElement(\"div\",{className:\"newPost-none\"},'Please sign in to post a reply');}const editorState=this.state.editorState;const statusMessage=React.createElement(StatusMessage,{error:error,errorClassName:\"newPost-message\",errorMessage:error||'Oops! Something went wrong.',type:\"modal\"});return React.createElement(\"div\",{className:\"newPost-show\"},statusMessage,React.createElement(Form,{loading:isLoading,className:\"attached fluid segment\"},React.createElement(RichEditor,{placeholder:\"Start typing your post content here...\",editorState:editorState,wrapperClassName:\"newPost-wrapper\",toolbarClassName:\"newPost-toolbar\",editorClassName:\"newPost-editor\",onEditorStateChange:this.onEditorStateChange,handleBeforeInput:this.handleBeforeInput,handlePastedText:this.handlePastedText}),React.createElement(Button,{color:\"blue\",size:\"small\",loading:isLoading,disabled:isLoading,onClick:this.onSubmit},React.createElement(Icon,{name:\"write\"}),\"Post\")));}}","map":{"version":3,"sources":["/home/yi/Desktop/rengorum/frontend/src/components/newpost/index.js"],"names":["React","Component","getSelectedBlock","htmlToDraft","List","EditorState","convertToRaw","Modifier","Form","Icon","Button","RichEditor","StatusMessage","NewPost","constructor","props","onEditorStateChange","editorState","setState","onSubmit","state","threadID","createPost","content","JSON","stringify","getCurrentContent","newPost","thread_id","isValidLength","contentState","maxLength","getPlainText","length","handleBeforeInput","input","handlePastedText","text","html","onChange","contentBlock","entityMap","forEach","value","key","mergeEntityData","replaceWithFragment","getSelection","contentBlocks","push","selectedBlock","newState","replaceText","getCurrentInlineStyle","type","createEmpty","componentWillReceiveProps","newProps","success","render","isAuthenticated","isLoading","error","statusMessage"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\r\nimport {getSelectedBlock} from 'draftjs-utils';\r\nimport htmlToDraft from 'html-to-draftjs';\r\nimport {List} from 'immutable';\r\nimport {EditorState, convertToRaw, Modifier} from 'draft-js';\r\nimport {Form, Icon, Button} from 'semantic-ui-react';\r\nimport './styles.css';\r\nimport RichEditor from '../richeditor';\r\nimport StatusMessage from '../statusmessage';\r\n\r\nexport default class NewPost extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      editorState: EditorState.createEmpty(),\r\n    };\r\n  }\r\n\r\n  componentWillReceiveProps(newProps) {\r\n    const {success} = newProps;\r\n    if (success) {\r\n      this.setState({\r\n        editorState: EditorState.createEmpty(),\r\n      });\r\n    }\r\n  }\r\n\r\n  onEditorStateChange = editorState => {\r\n    this.setState({\r\n      editorState,\r\n    });\r\n  };\r\n\r\n  onSubmit = () => {\r\n    const {editorState} = this.state;\r\n    const {threadID, createPost} = this.props;\r\n    const content = JSON.stringify(\r\n      convertToRaw(editorState.getCurrentContent()),\r\n    );\r\n    let newPost = {\r\n      thread_id: threadID,\r\n      content: content,\r\n    };\r\n    createPost(newPost);\r\n  };\r\n\r\n  isValidLength = contentState => {\r\n    const maxLength = this.props.maxLength || 1000;\r\n    return contentState.getPlainText('').length <= maxLength;\r\n  };\r\n\r\n  handleBeforeInput = input => {\r\n    const {editorState} = this.state;\r\n    if (!this.isValidLength(editorState.getCurrentContent())) {\r\n      return 'handled';\r\n    }\r\n  };\r\n\r\n  handlePastedText = (text, html, editorState, onChange) => {\r\n    if (html) {\r\n      const contentBlock = htmlToDraft(html);\r\n      let contentState = editorState.getCurrentContent();\r\n      contentBlock.entityMap.forEach((value, key) => {\r\n        contentState = contentState.mergeEntityData(key, value);\r\n      });\r\n      contentState = Modifier.replaceWithFragment(\r\n        contentState,\r\n        editorState.getSelection(),\r\n        new List(contentBlock.contentBlocks),\r\n      );\r\n      if (!this.isValidLength(contentState)) {\r\n        return 'handled';\r\n      }\r\n      onChange(\r\n        EditorState.push(editorState, contentState, 'insert-characters'),\r\n      );\r\n      return true;\r\n    }\r\n    const selectedBlock = getSelectedBlock(editorState);\r\n    const newState = Modifier.replaceText(\r\n      editorState.getCurrentContent(),\r\n      editorState.getSelection(),\r\n      text,\r\n      editorState.getCurrentInlineStyle(),\r\n    );\r\n    if (!this.isValidLength(newState)) {\r\n      return 'handled';\r\n    }\r\n    onChange(EditorState.push(editorState, newState, 'insert-characters'));\r\n    if (selectedBlock && selectedBlock.type === 'code') {\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  render() {\r\n    const {isAuthenticated, isLoading, error} = this.props;\r\n    if (!isAuthenticated) {\r\n      return (\r\n        <div className=\"newPost-none\">{'Please sign in to post a reply'}</div>\r\n      );\r\n    }\r\n    const {editorState} = this.state;\r\n    const statusMessage = (\r\n      <StatusMessage\r\n        error={error}\r\n        errorClassName=\"newPost-message\"\r\n        errorMessage={error || 'Oops! Something went wrong.'}\r\n        type=\"modal\"\r\n      />\r\n    );\r\n\r\n    return (\r\n      <div className=\"newPost-show\">\r\n        {statusMessage}\r\n        <Form loading={isLoading} className=\"attached fluid segment\">\r\n          <RichEditor\r\n            placeholder=\"Start typing your post content here...\"\r\n            editorState={editorState}\r\n            wrapperClassName=\"newPost-wrapper\"\r\n            toolbarClassName=\"newPost-toolbar\"\r\n            editorClassName=\"newPost-editor\"\r\n            onEditorStateChange={this.onEditorStateChange}\r\n            handleBeforeInput={this.handleBeforeInput}\r\n            handlePastedText={this.handlePastedText}\r\n          />\r\n          <Button\r\n            color=\"blue\"\r\n            size=\"small\"\r\n            loading={isLoading}\r\n            disabled={isLoading}\r\n            onClick={this.onSubmit}>\r\n            <Icon name=\"write\" />\r\n            Post\r\n          </Button>\r\n        </Form>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}